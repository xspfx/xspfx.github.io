<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edusphere Manifest</title>
  <style>
    :root {
      --bg-color: #0a0a0f;
      --text-color: #e0e0ff;
      --accent-color: #8a2be2;
      --highlight-color: #00ffff;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
    }
    header {
      text-align: center;
      padding: 2rem 1rem;
      background: linear-gradient(to right, var(--accent-color), var(--highlight-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    header h1 {
      font-size: 2rem;
      font-weight: bold;
      margin: 0;
    }
    main {
      max-width: 900px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    h2 {
      color: var(--accent-color);
      margin-top: 2rem;
      font-size: 1.5rem;
    }
    h3 {
      color: var(--highlight-color);
      margin-top: 1rem;
      font-size: 1.2rem;
    }
    ul {
      margin: 0.5rem 0 1rem 1.5rem;
    }
    footer {
      text-align: center;
      font-size: 0.8rem;
      color: #888;
      margin: 3rem 0 1rem;
    }
  </style>
</head>
<body>
  <header>
    <h1 id="manifest-title">Lade Manifest...</h1>
  </header>
  <main id="manifest-content"></main>
  <footer>
    <span id="version">subscriptionsPass.js ver. 1.0.2</span>
  </footer>

  <script>
    const lang = document.documentElement.lang || "de";
    const manifestPath = `i18n/${lang}.json`;

    async function loadManifest() {
      try {
        const res = await fetch(manifestPath);
        if (!res.ok) throw new Error("Manifest konnte nicht geladen werden");
        const manifest = await res.json();

        document.getElementById("manifest-title").textContent = manifest.title;
        document.getElementById("manifest-content").innerHTML = manifest.sections.map(renderSection).join("");
      } catch (err) {
        document.getElementById("manifest-title").textContent = "Manifest konnte nicht geladen werden";
        console.error(err);
      }
    }

    function renderSection(sec) {
      let html = `<section id="${sec.id}">`;
      html += `<h2>${escapeHTML(sec.title)}</h2>`;

      // Paragraphs
      if (sec.paragraphs) {
        html += sec.paragraphs.map(p => `<p>${p}</p>`).join("");
      }

      // List
      if (sec.list) {
        html += "<ul>";
        html += sec.list.map(li => `<li>${li}</li>`).join("");
        html += "</ul>";
      }

      // Subsections (optional!)
      if (sec.subsections) {
        html += sec.subsections.map(sub => {
          let subHtml = `<h3>${escapeHTML(sub.title)}</h3>`;
          if (sub.paragraphs) {
            subHtml += sub.paragraphs.map(p => `<p>${p}</p>`).join("");
          }
          if (sub.list) {
            subHtml += "<ul>";
            subHtml += sub.list.map(li => `<li>${li}</li>`).join("");
            subHtml += "</ul>";
          }
          return subHtml;
        }).join("");
      }

      // Closing
      if (sec.closing) {
        if (Array.isArray(sec.closing)) {
          html += sec.closing.map(c => `<p><strong>${c}</strong></p>`).join("");
        } else {
          html += `<p><strong>${sec.closing}</strong></p>`;
        }
      }

      html += "</section>";
      return html;
    }

    function escapeHTML(str) {
      return str
        ? str.replace(/&/g, "&amp;")
             .replace(/</g, "&lt;")
             .replace(/>/g, "&gt;")
             .replace(/"/g, "&quot;")
             .replace(/'/g, "&#039;")
        : "";
    }

    loadManifest();
  </script>
</body>
</html>
